<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Find Pattern - Stock</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      font-size: 1.5rem;
      background-color: #f8f9fa;
    }
    .chart {
      margin-bottom: 60px;
    }
    h1 {
      margin-bottom: 30px;
    }
    h2 {
      margin-top: 60px;
    }
    .card {
      margin-bottom: 30px;
    }
  </style>
</head>
<body>
  <div class="container-fluid">
    <h1 class="text-center">Stock Price Pattern Finder</h1>
    <div class="row">

<nav class="navbar navbar-expand-md bg-dark navbar-dark d-md-none mb-3">
  <div class="container-fluid">
    <a class="navbar-brand" href="#">Upload</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mobileUploadForm">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="mobileUploadForm">
      <div class="p-3 bg-light text-dark">
        <div id="InitialViewableMobile">
          <form>
            <div class="mb-3">
              <label for="fileCSVmobile" class="form-label">Stock Data File <strong>(CSV only)</strong></label>
              <input type="file" class="form-control" id="fileCSVmobile" accept=".csv" />
            </div>
          </form>
        </div>
        <div id="fileUploadViewableMobile"></div>
      </div>
    </div>
  </div>
</nav>

<!-- Sidebar for Desktop View -->
<div class="col-md-3 d-none d-md-block">
  <div class="card p-3 shadow-sm">
    <div id="InitialViewable">
      <form>
        <div class="mb-3">
          <label for="fileCSV" class="form-label">Stock Data File <strong>(CSV only)</strong></label>
          <input type="file" class="form-control" id="fileCSV" accept=".csv" />
        </div>
      </form>
    </div>
    <div id="fileUploadViewable"></div>
  </div>
</div>


      <!-- Charts Section -->
      <div class="col-md-9">
        <div class="card p-3 shadow-sm">
          <div id="heatmap" class="chart"></div>
        </div>
        <div class="card p-3 shadow-sm">
          <div id="stacked-bar" class="chart"></div>
        </div>
        <div class="card p-3 shadow-sm">
          <div id="surface-3d" class="chart"></div>
        </div>
        <div class="card p-3 shadow-sm">
          <div id="bubble" class="chart"></div>
        </div>
        <div class="card p-3 shadow-sm">
          <div id="sankey" class="chart"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

  <script>
    const x = ['-80 to -60', '-60 to -40', '-40 to -20', '-20 to 0', '0 to 20'];
    const y = ['-100 to -50', '-50 to 0', '0 to 50', '50 to 100', '100 to 150'];
    const z = [
      [8, 32, 176, 476, 323],
      [16, 40, 309, 578, 350],
      [8, 18, 109, 209, 143],
      [3, 7, 48, 85, 57],
      [3, 6, 18, 66, 31]
    ];

    Plotly.newPlot('heatmap', [{
      z: z, x: x, y: y, type: 'heatmap', colorscale: 'YlGnBu',
      hovertemplate: 'Volume: %{y}<br>Return: %{x}<br>Freq: %{z}<extra></extra>'
    }], {
      title: 'Heatmap of Frequency Table',
      xaxis: { title: 'Price Return % Range' },
      yaxis: { title: 'Volume % Range' }
    }, {
  responsive: true,
  displayModeBar: false,
  useResizeHandler: true
});

    const barData = x.map((colLabel, colIndex) => ({
      name: colLabel,
      type: 'bar',
      x: y,
      y: z.map(row => row[colIndex])
    }));
    Plotly.newPlot('stacked-bar', barData, {
      barmode: 'stack',
      title: 'Stacked Bar Chart',
      xaxis: { title: 'Volume % Range' },
      yaxis: { title: 'Frequency' }
    }, {
  responsive: true,
  displayModeBar: false,
  useResizeHandler: true
});

    Plotly.newPlot('surface-3d', [{
      type: 'surface',
      z: z, x: x, y: y,
      colorscale: 'Viridis',
      hovertemplate: 'Vol: %{y}<br>Return: %{x}<br>Freq: %{z}<extra></extra>'
    }], {
      title: '3D Surface Plot',
      scene: {
        xaxis: { title: 'Price Return % Range' },
        yaxis: { title: 'Volume % Range' },
        zaxis: { title: 'Frequency' }
      }
    }, {
  responsive: true,
  displayModeBar: false,
  useResizeHandler: true
});

    const bubbles = [];
    for (let i = 0; i < y.length; i++) {
      for (let j = 0; j < x.length; j++) {
        const freq = z[i][j];
        if (freq > 0) {
          bubbles.push({
            x: [x[j]],
            y: [y[i]],
            text: `Freq: ${freq}`,
            marker: {
              size: freq * 0.2,
              color: freq,
              sizemode: 'area',
              colorscale: 'Portland',
              showscale: false
            },
            type: 'scatter',
            mode: 'markers',
            name: ''
          });
        }
      }
    }
    Plotly.newPlot('bubble', bubbles, {
      title: 'Bubble Chart',
      xaxis: { title: 'Price Return % Range' },
      yaxis: { title: 'Volume % Range' }
    }, {
  responsive: true,
  displayModeBar: false,
  useResizeHandler: true
});

    const srcLabels = y.slice(0, 5);
    const tgtLabels = x.slice(0, 5);
    const source = [], target = [], value = [];

    for (let i = 0; i < srcLabels.length; i++) {
      for (let j = 0; j < tgtLabels.length; j++) {
        source.push(i);
        target.push(j + srcLabels.length);
        value.push(z[i][j]);
      }
    }

    const sankeyLabels = [...srcLabels, ...tgtLabels];
    Plotly.newPlot('sankey', [{
      type: 'sankey',
      orientation: 'h',
      node: {
        pad: 15,
        thickness: 20,
        line: { color: 'black', width: 0.5 },
        label: sankeyLabels
      },
      link: {
        source: source,
        target: target,
        value: value
      }
    }], {
      title: 'Sankey Diagram: Volume â†’ Return'
    }, {
  responsive: true,
  displayModeBar: false,
  useResizeHandler: true
});
  </script>

  <script>
    const InitialViewable = document.getElementById("InitialViewable");
    const fileUploadViewable = document.getElementById("fileUploadViewable");
    fileUploadViewable.style;
    InitialViewable.addEventListener("change", () => {
      console.log("mohan");
    });
  </script>
</body>
</html>
